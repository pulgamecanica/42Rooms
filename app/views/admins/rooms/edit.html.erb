<div class="container-lead flex-between">
	<div class="breadcrumb">/ <%= link_to 'HOME', home_path %> / <%= link_to 'ROOMS', rooms_path %> / <span class="active-page"><%= link_to @room.name, edit_room_path(@room) %> </span></div>
	<div class="buttons">
		<div class="btn btn-blue"><%= link_to 'Delete', room_path(@room), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this room?"} %></div>
	</div>
</div>
<div class="container-body">
	<div class="filters">
		<div class="card">
			<h3 class="card-title">White List</h3>
			<div class="card-body center">
				<ul>
					<% @room.white_lists.order(created_at: :desc).limit(3).each do |elem| %>
						<% if elem.persisted? %>
							<li class="flex-between">
								<%= link_to elem.user, edit_user_path(elem.user), class: "btn" %>
								<span class="remove-user">
									<%= link_to 'Remove', room_white_list_path(@room, elem), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to ban this user?"}, class: "btn btn-danger" %>
								</span>
							</li>
						<% end %>
					<% end %>
					<% if @room.white_lists.all.length > 3 %>
						<details style="text-align: center;">
							<summary>Show all (<%= @room.white_lists.all.length - 3 %> more)</summary>
							<% @room.white_lists.order(created_at: :desc).offset(3).each do |elem| %>
								<% if elem.persisted? %>
									<li class="flex-between">
										<%= link_to elem.user, edit_user_path(elem.user), class: "btn" %>
										<span class="remove-user">
											<%= link_to 'Remove', room_white_list_path(@room, elem), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to ban this user?"}, class: "btn btn-danger" %>
										</span>
									</li>
								<% end %>
							<% end %>
						</details>
					<% end %>
				</ul>
				<%= render 'white_list_form' %>
				<hr>
				<h5 class="text-secondary center">Import</h5>
				<br>
				<button class="btn btn-blue" onclick= "csv_form('white')"> CSV / JSON </button>
			</div>
		</div>
		<div class="card card-dark">
			<h3 class="card-title">Black List</h3>
			<div class="card-body center">
				<ul>
					<% @room.black_lists.order(created_at: :desc).limit(3).each do |elem| %>
						<% if elem.persisted? %>
							<li class="flex-between">
								<%= link_to elem.user, edit_user_path(elem.user), class: "btn" %>
								<span class="remove-user">
									<%= link_to 'Remove', room_black_list_path(@room, elem), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to ban this user?"}, class: "btn btn-danger" %>
								</span>
							</li>
						<% end %>
					<% end %>
					<% if @room.black_lists.all.length > 3 %>
						<details style="text-align: center;">
							<summary>Show all (<%= @room.black_lists.all.length - 3 %> more)</summary>
							<% @room.black_lists.order(created_at: :desc).offset(3).each do |elem| %>
								<% if elem.persisted? %>
									<li class="flex-between">
										<%= link_to elem.user, edit_user_path(elem.user), class: "btn" %>
										<span class="remove-user">
											<%= link_to 'Remove', room_black_list_path(@room, elem), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to ban this user?"}, class: "btn btn-danger" %>
										</span>
									</li>
								<% end %>
							<% end %>
						</details>
					<% end %>
				</ul>
				<%= render 'black_list_form' %>
				<hr>
				<h5 class="text-secondary center">Import</h5>
				<br>
				<button class="btn btn-blue" onclick= "csv_form('black')"> CSV / JSON</button>
			</div>
		</div>
	</div>
	<div class="box">
		<div class="squeeze-table text-secondary">
			<h3 class="center text-secondary">Edit Room</h3>
			<%= render 'room_form', room: @room %>
			<div style="margin: auto; max-width: 500px;">
				<br>
				<hr>
				<details>
					<summary style=""><h4 style="display: inline; text-decoration: underline;">Info/Tips</h4></summary>
					<h5>
						<h4 style="padding: 0; margin: 0.5rem 0;">Rules</h4>
						<p style="padding: 0; margin: 0;">At any point a user can be added to the black/white list, and this will prevent/allow the user from using the room.<br>Admin user can do anything in the application without restrictions, as long as it's a valid action.<br>Admins can belong to a white/black list if they wish to do so...<br>Staff42 will be automatically added to all the white lists of all rooms, so they will have access to all rooms.<br>User42 will be automatically aded to all the white lists of normal rooms, this way normal users will be able to schedule in normal rooms.<br>Other Users will not be added to any list automatically, an admin should add them if it's intended.</p>
						<h4 style="padding: 0; margin: 0.5rem 0;">Restrctions</h4>
						<p style="padding: 0; margin: 0;">Blocked users will be restricted from accessing any rooms, or actions on the application. They will only have access to the main page.</p>
						<p style="padding: 0; margin: 0;">Hidden rooms are still visible through their url, but they will not show on the home page.<br>Inactive rooms will not be available and they will not allow any schedules.<br>Both Inactive and Hidden rooms will not throw results on the home menu fast schedule search engine.</p>
						
						<h4>Rules</h4>
						<ul>
							<li>Users on the black list can't schedule meetings</li>
							<li>Users on the white list can schedule meeting without restrictons</li>
							<li>TODO: Normal Users can only schedule two rooms at the same time, and a max of 2 hrs per room</li>
							<li>TODO: A User with banned status can't schedule anything</li>
						</ul>
						<p>You can use the actions to upload files and update multiple users/rooms</p>
						<p>Click the button <%= link_to 'Show all', edit_room_path(@room, all: true), class: "text-secondary" %> to see all the history of reservations.</p>
					</h5>
					<hr>
				</details>
			</div>
			<h5 class="resources" style="text-align: center;">
				<button class="btn btn-danger center" style="position: relative; border-radius: 50%; width: 40px; height: 40px;"><span style="position: absolute; font-size: 25px; top: 50%; left: 50%; transform: translate(-50%, -50%);">?</span></button>
			</h5>
		</div>
	</div>
</div>
<div class="container-body">
	<div class="filters">
		<div class="card">
			<h3 class="card-title">Reservations</h3>
			<div class="card-body">
				<div class="card-buttons">
					<%= link_to 'Show all', edit_room_path(@room, all: true), class: "btn btn-blue" %>
					<%= link_to 'New Reservation', room_calendar_path(@room), class: "btn btn-blue" %>
				</div>
			</div>
		</div>
	</div>
	<%= render 'reservations_layout', reservations: @reservations, title: @room.name, first: @first, last: @last, total: @total, option: 1 %>
</div>

<span id="curtain" onclick="close_form()"></span>
<div id="csv-form">
	<%= form_with id: "file_form", method: :post do |form| %>
		<%= form.file_field :file %>
		<%= form.submit "Import" %>
	<% end %>
</div>

<script>
function close_form() {
    $("#curtain").css("display", "none");
    $("#csv-form").css("display", "none");
}

function csv_form(option) {
	$("#curtain").css("display", "flex");
	$("#csv-form").css("display", "inline-block");
	if (option === "white") {
		$("#file_form").attr("action", "import_users_to_whitelist")
    } else if (option === "black") {
		$("#file_form").attr("action", "import_users_to_blacklist")
    }
}
</script>